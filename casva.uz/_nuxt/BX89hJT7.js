import U from"./DVwSLOeJ.js";import{_ as G}from"./BCaFOzwy.js";import{e as Z,h as q,l as K,d as Q,f as X,u as J,k as ee,F as l}from"./plyUuadH.js";import{a as se,b as te}from"./C9ibN5t9.js";import{R as M}from"./C73we6Xy.js";import{p as oe}from"./BQOBHm4n.js";import{c as ae}from"./9sa6IpoK.js";import{k as re,l as ce,Q as d,E as u,X as e,Y as t,u as s,I as $,H as Y,a9 as V,V as O,R as I,Z as R,U as H,a3 as ie}from"./c1m8qkdf.js";import"./YyW3t6KU.js";import"./BNWA2ULP.js";import"./DlAUqK2U.js";const ne={class:"calculator-results-container"},le={class:"calculation-results-header d-flex justify-content-between align-items-center mb-24"},de=e("div",null,null,-1),me={class:"header"},ue={class:"calculation-results h-100 overflow-y-auto"},_e={class:"wrapper-background"},pe={class:"row"},he={class:"col-lg-4"},fe={class:"address-info-wrapper"},ve={class:"name"},ge={class:"data"},ye={class:"name"},ke={class:"data"},Ae={class:"col-lg-4"},Pe={class:"truck-info-wrapper h-100 d-flex flex-column justify-content-between align-items-center"},Ee={class:"row d-flex"},Fe={class:"col-7"},Oe={class:"truck-info"},be={class:"truck-name-header"},Le={class:"truck-info"},we={class:"truck-info"},Ce={class:"col-4 offset-1 d-flex align-items-center justify-content-end"},Te={class:"truck-image text-end"},$e={class:"text-center mt-24"},Ie={class:"col-lg-4"},Re={class:"parcel-details-wrapper"},De={class:"header"},Se={class:"parcel-info"},Ne={class:"name"},xe={class:"data"},Me={class:"parcel-info"},Ye={class:"name"},Ve={class:"data"},He={class:"parcel-info"},We={class:"name"},je={class:"data"},Be={class:"parcel-info"},ze={class:"name"},Ue={class:"data"},Ge={class:"parcel-info"},Ze={class:"name"},qe={class:"data"},Ke={key:0,class:"parcel-info"},Qe={class:"name"},Xe={class:"data"},Je={class:"parcel-info"},es={class:"name"},ss={class:"data"},ts={class:"calculation-price text-center mt-16"},os={key:0},as={class:"header"},rs={class:"price"},cs={key:1,class:"d-inline-flex flex-column align-items-center"},is={key:3,class:"m-0 text-center text-danger w-50 mx-auto py-3"},ys=re({__name:"calculation-results-bottomsheet",props:{setAddressErrors:{type:Function},checkAddress:{type:Function},setFieldErrors:{type:Function},values:{},errors:{},validate:{type:Function},fromAddresses:{},toAddresses:{},clearFormData:{type:Function}},setup(W){const r=W,{t:o}=Z(),b=q(),c=K(),D=Q(),S=X(),N=J(),m=ee(),j=async()=>{var y,k,A,P,E,F;c.$patch({isFetchingPrice:!0});const a=await r.validate();if(r.fromAddresses.every(i=>r.checkAddress(i))){r.setAddressErrors(M.from),c.$patch({isFetchingPrice:!1}),b.error({text:o("errors.fillInAddressFields")});return}if(r.toAddresses.every(i=>r.checkAddress(i))){r.setAddressErrors(M.to),c.$patch({isFetchingPrice:!1}),b.error({text:o("errors.fillInAddressFields")});return}if(!a.valid){c.$patch({isFetchingPrice:!1,isCalculationResults:!1}),b.error({text:o("errors.pleaseFillInAllFields")});return}if((n==null?void 0:n.value)!=null&&+r.values[l.WEIGHT.name]>+n.value.max_weight){c.$patch({isFetchingPrice:!1,isCalculationResults:!1}),b.error({text:o("errors.maxCarWeightIs",{maxWeight:(y=n.value)==null?void 0:y.max_weight})});return}let C=[],v=[];for(let i of r.fromAddresses)C.push([i.geometry.location.lat,i.geometry.location.lng]);for(const i of r.toAddresses)v.push([i.geometry.location.lat,i.geometry.location.lng]);const p=[];[...r.fromAddresses,...r.toAddresses].forEach(i=>{const h=se(i,c.regions);p.push(h==null?void 0:h.id)});const L=await te(C,v),g=Object.assign({},{...r.values,routes:[...r.fromAddresses,...r.toAddresses],partial_percentage:0,truck_type:n.value,regions:p,clientCompanyId:(((k=S.profile)==null?void 0:k.company_id)??0)>0?(A=S.profile)==null?void 0:A.company_id:null,offeredPrice:(P=m.$state.createOrderData)==null?void 0:P.offeredPrice,distance:L});(E=m.createOrderData)!=null&&E.edit_order_id?m.editOrder(g,+((F=m.createOrderData)==null?void 0:F.edit_order_id),r.clearFormData):m.createOrder(g,r.clearFormData)},w=()=>{c.$patch({isPriceFetched:!1,isCalculationResults:!1,priceList:[],isErrorFetchingPrice:!1})},B=()=>{N.openLoginModalFromCalculate(),c.$patch({isPriceFetched:!1,priceList:[]})},z=()=>{var a;N.$patch({offerPriceOrderPrice:((a=c.priceList[0])==null?void 0:a.price)??0,isOfferPriceNewOrder:!0})},n=ce(()=>c.priceList[0]);return(a,C)=>{var T,L,g,y,k,A,P,E,F,i,h,x;const v=U,p=G;return d(),u("div",{class:ie(["calculation-results-bottomsheet position-absolute bottom-0 start-0 end-0",{open:s(c).isCalculationResults&&s(c).priceList.length}])},[e("div",{class:"calculator-results-background",onClick:w}),e("div",ne,[e("div",le,[de,e("h4",me,t(s(o)("common.calculationResults")),1),e("button",{type:"button",onClick:w},[$(v,{width:"25",src:"/assets/image/icons/close-default.svg",alt:""})])]),e("div",ue,[e("div",_e,[e("div",pe,[e("div",he,[e("div",fe,[(d(!0),u(Y,null,V(a.fromAddresses,(f,_)=>(d(),u("div",{class:"address-info",key:_},[e("p",ve,t(s(o)("common.fromAddress"))+t(_>0?` ${_}`:"")+":",1),e("p",ge,t(f.full_address)+" "+t(a.values[s(l).LOAD_TIME]&&_>0?`, Ð² ${a.values[s(l).LOAD_TIME]}`:""),1)]))),128)),(d(!0),u(Y,null,V(a.toAddresses,(f,_)=>(d(),u("div",{class:"address-info",key:_},[e("p",ye,t(s(o)("common.toAddress"))+t(_>0?` ${_}`:"")+":",1),e("p",ke,t(f.full_address),1)]))),128))])]),e("div",Ae,[e("div",Pe,[e("div",Ee,[e("div",Fe,[e("div",Oe,[e("p",be,t(s(o)("common.selectedTruck")),1),e("p",Le,t((T=n.value)==null?void 0:T.title),1),e("p",we,t((L=n.value)==null?void 0:L.dim_x)+"x"+t((g=n.value)==null?void 0:g.dim_y)+"x"+t((y=n.value)==null?void 0:y.dim_z)+", "+t(s(o)("common.uptoKg",{weight:(k=n.value)==null?void 0:k.max_weight})),1)])]),e("div",Ce,[e("div",Te,[$(v,{src:((A=n.value)==null?void 0:A.icon)??"https://example.com",class:"w-100",alt:(P=n.value)==null?void 0:P.title},null,8,["src","alt"])])])]),e("div",$e,[e("button",{class:"text-decoration-underline",onClick:w,type:"button"},t(s(o)("common.edit")),1)])])]),e("div",Ie,[e("div",Re,[e("h4",De,t(s(o)("common.parcelDetails"))+":",1),e("div",null,[e("div",Se,[e("p",Ne,t(s(o)("common.selectedParcelWeight")),1),e("p",xe,t(a.values[s(l).WEIGHT.name])+" "+t(s(o)("common.kg")),1)]),e("div",Me,[e("p",Ye,t(s(o)("common.selectedParcelType")),1),e("p",Ve,t(a.values[s(l).PARCEL_TYPE.name]),1)]),e("div",He,[e("p",We,t(s(o)("common.receiverPhone")),1),e("p",je,t(a.values[s(l).RECEIVER_PHONE.name]&&s(oe)(a.values[s(l).RECEIVER_PHONE.name])),1)]),e("div",Be,[e("p",ze,t(s(o)("common.whoPays")),1),e("p",Ue,t(a.values[s(l).PAYER.name]?a.$t(`payers.${a.values[s(l).PAYER.name]}`):""),1)]),e("div",Ge,[e("p",Ze,t(s(o)("common.paymentType")),1),e("p",qe,t(a.values[s(l).PAYMENT_TYPE.name]?a.$t(`paymentTypes.${a.values[s(l).PAYMENT_TYPE.name]}`):""),1)]),a.values.partial_percentage?(d(),u("div",Ke,[e("p",Qe,t(s(o)("common.partialLoad")),1),e("p",Xe,t(a.values.partial_percentage?`${a.values.partial_percentage}%`:""),1)])):O("",!0),e("div",Je,[e("p",es,t(s(o)("common.orderComment")),1),e("p",ss,t(a.values[s(l).COMMENT.name]??"-"),1)])])])])])]),e("div",ts,[(E=s(c).priceList[0])!=null&&E.is_available?(d(),u("div",os,[e("p",as,t(s(o)("common.calculatedPrice")),1),e("div",rs,t(s(ae)(s(m).createOrderData.offeredPrice>0?s(m).createOrderData.offeredPrice:((F=s(c).priceList[0])==null?void 0:F.price)??0))+" UZS",1)])):O("",!0),s(D).isAuth&&((i=s(c).priceList[0])!=null&&i.is_available)?(d(),u("div",cs,[$(p,{"on-click":j,"is-loading":s(m).isLoading},{default:I(()=>{var f;return[R(t((f=s(m).createOrderData)!=null&&f.edit_order_id?s(o)("common.editOrder"):s(o)("common.placeOrder")),1)]}),_:1},8,["is-loading"]),s(m).isLoading?O("",!0):(d(),H(p,{key:0,class:"mt-2 bg-transparent text-decoration-underline text-dark","on-click":z},{default:I(()=>[R(t(s(o)("common.offerPrice")),1)]),_:1}))])):!s(D).isAuth&&((h=s(c).priceList[0])!=null&&h.is_available)?(d(),H(p,{key:2,"on-click":B},{default:I(()=>[R(t(s(o)("common.authorize")),1)]),_:1})):O("",!0),(x=s(c).priceList[0])!=null&&x.is_available?O("",!0):(d(),u("p",is,t(s(o)("errors.thisTypeOfTruckIsNotAvailable")),1))])])])],2)}}});export{ys as default};
